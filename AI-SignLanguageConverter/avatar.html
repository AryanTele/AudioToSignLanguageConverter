<!DOCTYPE html>

<html>
<head>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Divanshu Singh - Thapar University" >
    <link rel="icon" href="images/favicon.png">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Baloo" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <title>ISL : Avatar Page</title>
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta http-equiv="Access-Control-Allow-Methods" content="GET">
    <link rel="stylesheet" href="css/cwasa.css" />
    <script type="text/javascript" src="js/allcsa.js"></script>
    <script language="javascript">
        // Initial configuration
        var initCfg = {
            "avsbsl" : ["luna", "siggi", "anna", "marc", "francoise"],
            "avSettings" : { "avList": "avsbsl", "initAv": "marc" }
        };

        // global variable to store the sigmal list
        var sigmlList = null;

        // global variable to tell if avatar is ready or not
        var tuavatarLoaded = false;
    </script>

    <script type="text/javascript">
        function submit()
        {
            document.getElementById("startrunning").click(); // Simulates button click
            document.submitForm.submit(); // Submits the form without the button
        }
    </script>

    <script src="https://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
        google.load("elements", "1", {
            packages: "transliteration"
        });
        function onLoad(){
            var options = {
                sourceLanguage: google.elements.transliteration.LanguageCode.ENGLISH,
                destinationLanguage: [google.elements.transliteration.LanguageCode.HINDI],
                shortcutKey: 'ctrl+g',
                transliterationEnabled: true
            };
            var control = new google.elements.transliteration.TransliterationControl(options);
            // control.makeTransliteratable(['transliterateTextarea']);

        }
        google.setOnLoadCallback(onLoad);
        function myread(){
            var text=document.conversion.transliterateTextarea;
            var tcontent=text.value;
            window.alert(tcontent);
            return tcontent;
        }

    </script>
</head>
<body onload="CWASA.init(initCfg);" >

    <div id="loading" class="container">
    <div class="row text-center"><span style="background-color:#ebf8a4; padding: 8px 20px;">Loading ... Please wait...</span></div>
</div>

    <!-- left side division starts here -->

    <script language="javascript" src="js/animationPlayer.js"></script>

    <div style="box-sizing: border-box; width: 70%; height: 60%; padding: 15px; float:right; margin-right:14%;" >
        <table align="center" style="width:100%; height:100%;" >
            <tr align="center">
                <!--================================================================-->
                <!-- CWA signing avatar panel 0 -->
                <!--================================================================-->
                <!-- Replaced by an avatar panel -->
                <!--================================================================-->
                <td width="100%" height="90%" >
                    <div class="CWASAAvatar av0" align="center" ></div>
                </td>
                <!--================================================================-->
            </tr>
            <tr>
                <td>
                    <p class="alert-warning text-center" style="padding:5px; font-size:20px; font-weight:bold;" id="textHint"></p>
                </td>
            </tr>
            <tr style="display:none;">
                <td align="center">
                    <span class="CWASAAvMenu av0" ></span>
                    <input type="button" value="Sign" class="bttnPlaySiGMLURL av0" />
                    <input type="button" value="Stop" class="bttnStop av0" />
                    <span class="CWASASpeed av0" ></span>
                    <br/>
                    <span style="font-size: 90%;" >
                                Sign/Frame:
                                <input class="txtSF av0" value="0/0" type="text">
                                Gloss:
                                <input class="txtGloss av0" value="[none]" type="text">
                            </span>
                    <!--  CachedSiGML URL  -->
                    <input type="text" id="URLText" class="txtSiGMLURL av0 undisplayed" value="" />
                    <script language="text/javascript">
                        // Set default sign
                        setSiGMLURL("SignFiles/hello.sigml");
                    </script>
                </td>
            </tr>
        </table>
    </div>
    <div style="width:80%; padding:15px; margin-left:14%;">


        <form id="inputText">
            <input id="dom-target" type="text" name="firstname" hidden><br>
        </form>
        <!--<input id="dom-target1" type="text" x-webkit-speech><br>-->


        <!--<div id="menu1">-->
            <!--<br/>-->
            <!--<br/>-->
            <!--<button onclick="clickme()" id="btnRun">GO</button>-->
        <!--</div>-->
        <div class="row center">
            <a onclick="startDictation()" class="btn-floating btn-large waves-effect red"><i class="large material-icons">mic</i></a>
        </div>
        <div id="debuggercontainer" style="margin-top:10px; border-top:3px solid black;">
            <br><strong>Debugger</strong></br>
            <div id="debugger"></div>
        </div>
    </div> <!-- left side division ends here -->

<script type="text/javascript" src="js/player.js"></script>
<script type="text/javascript">
    /*
        Load json file for sigml available for easy searching
    */
    $.getJSON("js/sigmlFiles.json", function(json){
        sigmlList = json;
    });

    // code for clear button in input box for words
    $("#btnClear").click(function() {
        $("#inputText").val("");
    });

    // code to check if avatar has been loaded or not and hide the loading sign
    var loadingTout = setInterval(function() {
        if(tuavatarLoaded) {
            $("#loading").hide();
            clearInterval(loadingTout);
            console.log("Avatar loaded successfully !");
        }
    }, 1000);


    // code to animate tabs

    alltabhead = ["menu1-h", "menu2-h", "menu3-h", "menu4-h"];
    alltabbody = ["menu1", "menu2", "menu3", "menu4"];

    function activateTab(tabheadid, tabbodyid)
    {
        for(x = 0; x < alltabhead.length; x++)
            $("#"+alltabhead[x]).css("background-color", "white");
        $("#"+tabheadid).css("background-color", "#d5d5d5");
        for(x = 0; x < alltabbody.length; x++)
            $("#"+alltabbody[x]).hide();
        $("#"+tabbodyid).show();
    }

    activateTab("menu1-h", "menu1"); // activate first menu by default
    function startDictation() {

        console.log('reached here');

        if (window.hasOwnProperty('webkitSpeechRecognition')) {

            var recognition = new webkitSpeechRecognition();

            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.lang = "en-US";
            recognition.start();

            recognition.onresult = function(e) {
                // document.getElementById('transcript').value = e.results[0][0].transcript;
                console.log('labelll');
                console.log(e.results[0][0].transcript);
                document.getElementById('dom-target').value = e.results[0][0].transcript;
                // document.getElementById('dom-target').value = "0 axe colour forgive livewhere tools 1 bad colours form lock read touch 10 badminton come four long ready toward 100 bag comeover fourhundred lorry receive town 11 bake cometoyou fouroclock lose reception track 12 communicate fourteen loss rectangle trade-equipment 13 ballon communication france loss1 red train 1month bandage compare friday lotus regions transport 2-3fingerbent bangali compass loud regular travel 2 basketball complain germany love tree 2months bat complaint get man trophy 3 bath concentrate girl mango remind truck 4 beak confuse give-form manner remove 5 bearwithit congratulations give-me many repeat try 6 beat go-with-you march research tub 7 beautiful go married responsibility tuesday 8 become continue gold may responsible turn 9 before control good maybe resting_position turnip A begin cook greece me result turnleft behind coolie green meet roof tv C belgium copy grey mind round-hand twelveclock Computer bell correct half-past minicom run twenty D below halfpast mistake sad two bench count hang monday same twohundred F bend cover hardofhearing money save twooclock G benefit crash havealook more say typewriter H bent-hand cream he morning science typist I berth cricket mother scotland ugly Iv best criticize hearing my screen umbrella J better crow n-n(norfolk) search under K between cry hello nagpur see understand L bhagat cucumber help-me nails semi-roundhand uniform M bhangra cup help-you name send-me university N bible cut her namewhat send until O big cycle hers national seven up bird hill near sevenhundred urdu Q black date him need sevenoclock us R blackboard day himself needle seventeen vadodara Rain blow deaf hindi never sewingmachine van S blue decrease hindu shake T boat delete hire news short vegetable Table.AUS body dept his next sign vegetables U bogies desk hockey nextyear silver velvet V boil hold nice sitandmeet very W book develop holland night six veryverydifficult X borrow differences home nine sixhundred video Y bowl different how ninehundred sixoclock visit Z boxing difficult howareyou nineoclock sixteen volleyball about boy discuss howmany nineteen slow vomit above break-in divide howmuch no soft vote absorb break doctor hun none sorry wait accept bridge doctor1 hundred north-pole spelling wales access brighton donotunderstand hungry note-book stay walkacross accident bring down idea note-money stubborn wall-clock accuse britain draw ignore now want achakan broom dream number sunday was across brown drinking impossible nurse switzerland wash act brush easy improve offer tabla waste acting bsl eat in office table-tennis water-bottle active education increase officer tablet water actor budhpoornima educationalterms index.html often tailor water1 actress eid informus old take we add building eight infrontof talk weapon advice bulb eighteen injection on tall weaver advise bullockcart eighthundred one tamil aeroplane busy eightoclock onehundred tap weigh afraid bye electrician internet oneoclock taste weight africa c-x electricity interpreter onerupee taxi welcome after cabbage issues onetoone teach well afternoon calculator elevenoclock iunderstand onion teacher west age call email ix-down ooty teachme what agree calm-down ix-left open teachyou wheat alive can empty jain opendoors tear when all cancel encourage january openhand tease where allah cannot engine jealous operation teat which allday canyousign jeep opraise-clap(deaf) technical whistle allover car england or teeth white allow carpenter english join orange who almirah carrom enjoy jug order temperature why alone carrot enter jump organise temple wide always carry equal june ten will ambulance catch-2 justamoment our tennis win america catch eraser kannada ourself tenoclock wipe-off among cauliflower escape kanpur out thankyou wipe andhrapradesh cement essay karate over that wire angel center evening keep own theif wish angry certificate every kerala paranoid their with announce chair everyday key parts them without chalk everyyear keyboard past themselves woman changeback exam kite pay-me then word answer changemind examination know pay there work chase examine knowledge pen thermometer worn(warn) any check example knowwell person thermus worry anything chemistry expensive koli phone these worse appear cheque experience la phoneme they worst apple chess eyelash laboratory phoneyou think wrestling appointment child factory ladder pick thirsty write children fail-loser lakhnow pink thirteen writedown are chilly fall languages plan this writesend area christian far late please thorn wrong argue christmas farmer later pooryou those x-ray around church fat laugh possible thread yeah arrange cinema father lead pot three yellow arrest circle fear leafy-vegetables pound threehundred yes arrive circus leak power threeoclock yesterday art clap feed learn practice throw you asia class feel leave prayer thumb-little-finger youfillinwipe-off classroom few lecturer pretend thumb youhowold clerk fifteen lend print thumbup your assam click fight less problem thursday yourhobbieswhat climb fill-in letmeknow profit ticket yournamewhat at climbdown fill letter provide ticketchecker yours atlast climbup fingerspell level purple tie yourself attend clinic finish library put-on-letter tiffinbox yourselves audiologist close five putonleft tight zebra-crossing auditorium closedhand fivehundred light-house quarterpast tighten australia cloud fiveoclock quarterto time zoo austria clown flood line question tippi autorickshaw cobbler floor quick today available fly list quiet together avoid collect food litter quote tomato awful college forever little-fingerhand quran tomorrow";
                console.log(document.getElementById('dom-target').value);
                clickme();

                recognition.stop();
                // document.getElementById('labnol').submit();
            };

            recognition.onerror = function(e) {
                recognition.stop();
            }

        }
    }

    function clickme() {
        // read the input paragraph from the text box
        // trim it to remove any spaces from sides

        console.log("reading inpurrrr");
        //inputText = $("#inputText").val().trim();


        //document.getElementById('foo').value = 'bar';
        //console.log("reading input");

        //var x = document.getElementById("inputText").value;

        //inputText = $("#inputText").val().trim();
        //inputText = <?php echo $varrr;?>;

        //var valll = "<?php echo $ff ?>";
        //console.log(valll);



        var div = document.getElementById("dom-target");
        var myData = document.getElementById('dom-target').value;
        console.log('##########' + myData);

        inputText = myData;
        // read the language that has been set
        lang = "English"; // using english for default
        tokens = [];

        if(lang=="English") {

            // tokenize the english paragraph
            tokenString = tokenizeEnglish(inputText);
            tokens = tokenString.split(',');
            console.log("Got tokens");

        } else if(lang == "Hindi") {

            // tokenize the english paragraph
            tokenString = tokenizeHindi(inputText);
            tokens = tokenString.split(',');
            console.log("Got tokens");

        }

        // remove empty values from tokens
        for(x = 0; x < tokens.length; x++) {
            t = tokens[x];

            if(t == "")
                tokens.splice(x, 1);
        }

        console.log(tokens);

        // process tokens based on language settings
        // use the script to generate the sigml files available and if
        // word file is available use word file less speak as letter based
        // list of sigmlfile is available in sigmlArray.js


        for(x = 0; x < tokens.length; x++) {
            // process each token
            t = tokens[x];
            if(t == "EOL")
                continue;
            // convert token to lower case for seaching in the database
            // search for name and it will return filename if it will exists
            t = t.toLowerCase();
            t = t.replace('.',""); // remove the puntuation from the end
            tokens[x] = t;
        }

        console.log(tokens);

        // reset the wordArray and arrayCounter here
        wordArray = [];
        arrayCounter = 0;
        console.log("sigmllength : "+sigmlList.length);
        for(x = 0; x < tokens.length; x++)
        {
            wordfoundflag = false;
            t = tokens[x];
            for(y = 0; y < sigmlList.length; y++) {
                if(sigmlList[y].name == t) {
                    console.log(sigmlList[y].sid);
                    wordArray[arrayCounter++] = new FinalText(t, sigmlList[y].fileName);
                    wordfoundflag = true;
                    break;
                }
            }

            // if word not found then add chars - starts here
            if(wordfoundflag == false) {
                wordlen = t.length;
                for(p = 0; p < wordlen; p++) {
                    q = t[p];
                    //q=q.toUpperCase();
                    for(k = 0; k < sigmlList.length; k++) {
                        if(sigmlList[k].name == q) {
                            wordArray[arrayCounter++] = new FinalText(q, sigmlList[k].fileName);
                            break;
                        }
                    }
                }
                max = 0,countit=0;

                for(k=0;k<sigmlList.length;k++)
                {
                    countit++;
                    if(sigmlList[k].sid>max)
                    { max = sigmlList[k].sid; }
                }
                console.log("maxi is : "+max);
                max = max + 1;
                if(t!="EOL"){
                    console.log("k is : "+k);
                    var obj = {"sid": max,"name": t,"fileName": t+".sigml"};
                    /*// sigmlList.push(obj);
               file="sigmlFiles.json";
              //$json = json_decode(file_get_contents($file),true);

              //$json[$countit] = array("sid" => $max, "name" => $t, "fileName" => $t+".sigml");


                // file_put_contents($file, json_encode($json));*/
                    /*
                    $json = file_get_contents('sigmlFiles.json');
                    $data = json_decode($json);
                    $data[] = $_POST[obj];
                    file_put_contents('sigmlFiles.json', json_encode($data));*/
                    /*
                    <?php
                    $data[] = $_POST['{"sid": max,"name": t,"fileName": t+".sigml"}'];

                    $inp = file_get_contents('sigmlFiles.json');
                    $tempArray = json_decode($inp);
                    array_push($tempArray, $data);
                    $jsonData = json_encode($tempArray);
                    file_put_contents('sigmlFiles.json', $jsonData);
                    ?>
                    */

                    var newdata = JSON.stringify(sigmlList);
                    console.log(newdata);

                }
            }
            // if not word found part ends here
        }


        console.log(wordArray);
        console.log(wordArray.length);

        $("#debugger").html(JSON.stringify(wordArray));

        // wordArray object contains the word and corresponding files to be played
        // call the startPlayer on it in syn manner
        totalWords = wordArray.length;
        i = 0;

        var int = setInterval(function () {
            if(i == totalWords) {
                if(playerAvailableToPlay) {
                    clearInterval(int);
                    finalHint = $("#inputText").val();
                    $("#textHint").html(finalHint);
                }
            } else {
                if(playerAvailableToPlay) {
                    playerAvailableToPlay = false;
                    startPlayer("SignFiles/" + wordArray[i].fileName);
                    $("#textHint").html(wordArray[i].word);
                    i++;
                }
            }
        }, 3000);


    }


</script>
</body>


</html>